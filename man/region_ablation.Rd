% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/region_ablation.R
\name{region_ablation}
\alias{region_ablation}
\title{Iteratively Refine Biomarker by Single-Region Ablation to Minimize SSE}
\usage{
region_ablation(
  initial_numerator_regs,
  initial_denominator_regs,
  var_composition,
  prepared_data_list,
  config,
  datasets_to_evaluate,
  groups_to_evaluate = c("CU", "CI"),
  features = NULL,
  verbose = TRUE
)
}
\arguments{
\item{initial_numerator_regs}{Character vector of initial numerator regions.}

\item{initial_denominator_regs}{Character vector of initial denominator regions.}

\item{var_composition}{Numeric. Parameter indicating how features are combined
(e.g., 0 = volume-weighed, 1 = arithmetic mean). Passed to internal CVR calculation.}

\item{prepared_data_list}{List. The output from \code{preprocess_data()},
containing filtered data for multiple datasets.}

\item{config}{List. The loaded main configuration object from \code{preprocess_data$config}.
Must contain \code{preprocessing$id_column}, \code{model_equations$eq_group_string},
and \code{power_params}.}

\item{datasets_to_evaluate}{Character vector. Names of the datasets within
\code{prepared_data_list} to use for evaluating SSE during ablation.}

\item{groups_to_evaluate}{Character vector. Groups ("CU", "CI") to evaluate
within each dataset. Defaults to \code{c("CU", "CI")}.}

\item{features}{Character vector or NULL. A specific list of feature names
(columns in \code{data_suv_bi}) to consider. If NULL (default), common features
across all \code{datasets_to_evaluate} will be identified and used. The initial
numerator/denominator regions must be a subset of these features.}

\item{verbose}{Logical. Print progress messages? Defaults to TRUE.}
}
\value{
A list containing:
\item{final_numerator_regs}{Character vector of the refined numerator regions.}
\item{final_denominator_regs}{Character vector of the refined denominator regions.}
\item{initial_aggregated_sse}{Numeric. The aggregated SSE of the initial biomarker.}
\item{final_aggregated_sse}{Numeric. The aggregated SSE of the refined biomarker.}
\item{ablation_log}{A data frame tracking each removed region, the iteration,
and the aggregated SSE before and after its removal.}
\item{per_dataset_sse_initial}{Named list. SSE for each dataset/group with initial biomarker.}
\item{per_dataset_sse_final}{Named list. SSE for each dataset/group with final biomarker.}
}
\description{
Takes an initial biomarker definition (numerator and denominator regions) and
iteratively removes the single region whose removal most decreases the
aggregated Sample Size Estimate (SSE) across specified datasets and groups.
The process stops when no single region removal further decreases the SSE.
}
\details{
The function works as follows:
\enumerate{
\item Identifies common features across \code{datasets_to_evaluate} if \code{features} is NULL.
Validates \code{initial_numerator_regs} and \code{initial_denominator_regs} against these.
\item Calculates the baseline aggregated SSE for the initial biomarker.
\item Enters an iterative loop:
a. In each iteration, it temporarily removes one region at a time from the
current numerator, recalculates the CVR, and then calculates the aggregated SSE.
b. It does the same for regions in the current denominator.
c. It identifies the single region (from num or den) whose removal results
in the lowest new aggregated SSE.
d. If this lowest new SSE is better (lower) than the current baseline SSE,
the identified region is permanently removed, the baseline SSE is updated,
and the removal is logged. The loop continues.
e. If no single region removal improves the aggregated SSE, the loop stops.
The aggregation of SSE across datasets/groups is currently a simple mean.
}
}
